# Эксплуатация RCE, LPE. К условия дан файл admin-pass.txt
Начну исследование сервера с использования Nmap, проверки открытых портов и просмотра сервисов которые работают на этих портах

<img width="831" height="373" alt="Снимок экрана 2025-08-27 в 18 02 29" src="https://github.com/user-attachments/assets/91bd653d-47d7-4147-8926-c63193ca1b99" />

Пробую найти CVE под найденные сервисы по их версиям и запущу gobuster с медиум листом для нахождения интересных директорий

<img width="829" height="208" alt="Снимок экрана 2025-08-27 в 18 05 16" src="https://github.com/user-attachments/assets/32de7545-d56e-4147-a8ca-214291b59002" />

Известных уязвимостей под сервисы найти не удалось поэтому начну с проверку /admin, есть поля для ввода логина и пароля, пробую логин admin и перебор пароля из текстового файла данного нам к заданию. Используя Burp Intrududer проверим формирование куки. Сразу вижу формирование токенов при каждом запросе при обновлении страницы

<img width="841" height="111" alt="Снимок экрана 2025-08-27 в 18 08 19" src="https://github.com/user-attachments/assets/6e8d9699-0e0c-4e8a-90fc-0f1ceae511b8" />

Продолжу поиск по найденным директориям, есть /login,  так же в Burp intruder, замечаю, что админ токен меняется при подаче строки «Pass!BN» из данного нам файла admin-pass.txt по условию задачи.

<img width="819" height="232" alt="Снимок экрана 2025-08-27 в 18 10 18" src="https://github.com/user-attachments/assets/0d840d1d-4a3c-4f27-8e63-804d86c9fc28" />

Полученная учетная запись так же подходит по прошлой директории /admin, логинимся за админа и видим используеюмую версию GRAV сервера

<img width="822" height="78" alt="Снимок экрана 2025-08-27 в 18 11 55" src="https://github.com/user-attachments/assets/338597e9-f859-42ba-b9a1-109b3c1947de" />

Под эту версию GRAV имеется CVE с готовым эксплоитом, но для эксплуатации нужна ОС и его версия, для выбора пейлоада который буду отправлять, узнаю ОС при помощи nmap

<img width="829" height="523" alt="Снимок экрана 2025-08-27 в 18 13 37" src="https://github.com/user-attachments/assets/63b4ac9b-979c-4941-a441-9d69826242c1" />

ОС - windows, выбрал использование пейлоада под powershell, из опыта знаю, что лучшего всего пейлоад закодировать в base64. Подниму слушателя nc -nlvp 4444 и запускаю эксплойт с полезной нагрузкой. Эксплойт успешно срабатывает и забираю первый флаг

<img width="829" height="369" alt="Снимок экрана 2025-08-27 в 18 15 41" src="https://github.com/user-attachments/assets/8089cc62-b14f-419a-b682-b0cd6529bb7b" />

По условию задачи есть еще один флаг, который лежит в директории ADMIN, либо root, пробую зайти из под действующего пользователя в эти директории и ничего не обнаруживаю, скорее всего у меня недостаточно прав. Проверю пользователя и его привилегии

<img width="830" height="360" alt="Снимок экрана 2025-08-27 в 18 19 46" src="https://github.com/user-attachments/assets/438864a4-3bc0-409d-83e6-db4dbba6d482" />

Вижу знаки вопроса вместо привилегий. Меняю кодировку в шелл коде для корректного отображения с ASCII на UTF-8.

<img width="828" height="152" alt="Снимок экрана 2025-08-27 в 18 20 55" src="https://github.com/user-attachments/assets/8b86ba30-2a0b-4f05-91a4-82878cdbfd68" />

Доступна служба SeImpersonatePrivilege, проверю запущена ли служба очереди печати

<img width="827" height="92" alt="Снимок экрана 2025-08-27 в 18 21 56" src="https://github.com/user-attachments/assets/76f073a3-c365-4f2f-9618-ee9974a73f33" />

Так как служба выключена, сделал выбор на злоупотребление привилегий используя JuicyPotato. Ранее, определил нашу OS в виде Windows 10 pro и версией, которая походит под данный вид эксплойта. Для реализации буду использовать модуль Metasploit c эксплоитом ms16_075_reflection_juicy для получения повышенных прав и multi/script/web_delivery, для формирования нового пейлоада с использованием meterpreter и получения сессии.
Выбираю эксплойт и задаю параметры

<img width="833" height="514" alt="Снимок экрана 2025-08-27 в 18 26 59" src="https://github.com/user-attachments/assets/3a9888fc-b897-4855-8463-51a7635bdb05" />

Получаю новый пейлоад, которуй будем использовать через ранее использованный эксплойт Grav_CMS для получения сессии.

<img width="830" height="379" alt="Снимок экрана 2025-08-27 в 18 28 23" src="https://github.com/user-attachments/assets/c63f1eb2-d79f-47f7-a35a-baaf5198078c" />

Сессия получена, переключаюсь на ms16_075_reflection_juicy, устанавливаю нужные параметры и ранее полученную сессию, итоговые настройки выглядят так

<img width="835" height="395" alt="Снимок экрана 2025-08-27 в 18 29 25" src="https://github.com/user-attachments/assets/229987f0-14af-4d07-9107-b61b8283a2a0" />

Запускаю эксплойт и получаю новую сессию под уровнем пользователя SYSTEM

<img width="834" height="353" alt="Снимок экрана 2025-08-27 в 18 30 12" src="https://github.com/user-attachments/assets/ed1a3d28-f065-48af-8cf8-dfde3645ac8a" />

Забираю флаг из директории root

<img width="831" height="380" alt="Снимок экрана 2025-08-27 в 18 31 00" src="https://github.com/user-attachments/assets/b36c782e-d163-4835-a0ef-9d290a538ff0" />


